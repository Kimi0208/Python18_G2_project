{% extends '_base.html' %}
{% load static %}
{% load task_form %}

{% block links %}
    {% if request.user.is_authenticated %}
        {% if perms.webapp.add_task %}
            <button class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm action-btn_task"
                    data-action_task="{% url 'webapp:create_task' %}">
                <i class="fas fa-download fa-sm text-white-50"></i> Создать задачу
            </button>
<!--             <a href="#" onclick="showCreateModal()" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm">
                <i class="fas fa-download fa-sm text-white-50"></i>  Создать задачу </a> -->
        {% endif %}
    {% endif %}
{% endblock %}
{% block menu %}
{% endblock %}

{% block content %}
    <div style="width: 15%; border-right: 1px solid #e3e6f0; overflow-x: auto; white-space: nowrap; border-radius: 0; overflow-y: auto; font-size: 14px" class="list-group";>
        <table class="table table-hover">
          <thead>
            <tr>
              <th scope="col">Отделы и сотрудники</th>
            </tr>
          </thead>
          <tbody>
            {% for department in departments %}
                <tr>
                    <td style="cursor: pointer" class="get-tasks_btn" data-whose_table="{{ department.name }}" data-get_tasks="{% url 'webapp:department_tasks' pk=department.pk%}">{{ department.name }}</td>
                </tr>
            {% endfor %}
            {% for user in users %}
                <tr>
                    <td style="cursor: pointer" class="get-tasks_btn" data-whose_table="{{ user.username }}" data-get_tasks="{% url 'webapp:user_tasks' pk=user.pk %}">{{ user.first_name }} {{ user.last_name }}</td>
                </tr>
            {% endfor %}

          </tbody>
        </table>
    </div>
   
    <div id="main_area">

         {% include 'partial/tables.html' %}
    </div>
    <div class="card-body" id="task-detail-info" style="border-left: solid 1px #e3e6f0;  font-size: 14px; width: 25%">
        <div style="display: flex; justify-content: space-between;" class="bg-primary" >
            <button class="action-btn_task btn btn-primary btn-sm" data-action_task="" id="task_edit">Редактировать</button>
    {#        <button class="action-btn_task btn btn-primary" data-action_task="" id="add_file">Прикрепить файл</button>#}
    {#        <button class="action-btn_task btn btn-primary" data-action_task="" id="add_subtask">Создать подзадачу</button>#}
            <button class="get-info-btn_task btn btn-primary btn-sm" data-get_info_task="" id="task_files">Файлы</button>
            <button class="btn btn-primary btn-sm" data-get_history_task="" id="task_history">История</button>
    {#        <button class="btn btn-primary" style="display: none" id="prev_task">Назад</button>#}
    {#        <button class="action-btn_task btn btn-primary" data-action_task="" id="comment_add">Добавить комментарий</button>#}
            <div class="dropdown">
              <button class="btn btn-primary dropdown-toggle btn-sm" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Добавить
              </button>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <button class="dropdown-item action-btn_task" data-action_task="" id="add_subtask">Подзадачу</button>
                <button class="dropdown-item action-btn_task" data-action_task="" id="add_file">Файл</button>
                <button class="dropdown-item action-btn_task" data-action_task="" id="comment_add">Комментарий</button>
              </div>
            </div>
        </div>
    <h4 class="card-title" id="task_title"></h4>
        <p class="card-text" id="task_type"></p>
        <p class="card-text" id="task_created_at"></p>
        <p class="card-text" id="task_start_date"></p>
        <p class="card-text" id="task_status"></p>
        <p class="card-text" id="task_priority"></p>
        <p class="card-text" id="task_updated_at"></p>
        <p class="card-text" id="task_done_at"></p>
        <p class="card-text" id="task_deadline"></p>
        <p class="card-text" id="task_author"></p>
        <div id="description_field">
            <h4 id="description_field_header" style="background: antiquewhite">Описание</h4>
            <div id="description_info">
                <span id="task_description"></span>
            </div>
        </div>
        <div id="parent_field">
            <h4 id="parent_field_header" style="background: antiquewhite">Относится к</h4>
            <div id="parent_info">
            </div>
        </div>
        <div id="subtasks_field">
            <h4 id="subtasks_field_header" style="background: antiquewhite">Подзадачи</h4>
            <div id="subtasks_info">
            </div>
        </div>
        <div id="comments_field">
            <h4 id="comments_field_header" style="background: antiquewhite">Комментарии</h4>
            <div id="comments_info">
            </div>
        </div>
    </div>
    <div id="detail-task-modal_window" class="modal action_task_modal"></div>

    

    <div id="action-task-modal_window" class="modal action_task_modal"></div>
<!--     </div>

    <div id="action-task-modal_window" class="modal">
    </div>

    <div class="modal" id="taskModal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modal-title"></h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p>Modal body text goes here.</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary">Save changes</button>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal" id="taskCreateModal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modal-title">Create Task</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
            <form class="custom_form" action="{% url "webapp:create_task" %}" method="POST">
              <div class="modal-body">{% task_form as form %}
                {% include 'partial/form.html' with form=form fields_only=True %}
              </div>
              <div class="modal-footer">
                <input value="Создать" type="submit" class="btn btn-primary">
              </div>
            </form>
        </div>
      </div>
    </div> -->

{% endblock %}
{% block scripts %}
    <script>
        $(document).ready(function() {
          $('#DataTable').DataTable();
        });
    </script>
{% endblock %}